<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Personal Assistant | Group 21</title>

    <!-- Lucide Icons (圖標庫) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Marked (Markdown Parser) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Native CSS Styles -->
    <link rel="stylesheet" href="style/style.css">
</head>

<body>

    <!-- LOGIN VIEW -->
    <div id="login-view">
        <div class="login-bg"></div>
        <div class="login-content animate-fade-in">
            <div
                style="display: inline-flex; padding: 1rem; background: rgba(79, 70, 229, 0.2); border-radius: 50%; margin-bottom: 1.5rem;">
                <i data-lucide="bot" width="48" height="48" style="color: #818cf8;"></i>
            </div>
            <h1 style="font-size: 3rem; margin-bottom: 1rem; font-weight: 800;">
                AWS <span class="title-gradient">Personal Assistant</span>
            </h1>
            <p style="color: var(--text-muted); font-size: 1.2rem; margin-bottom: 2.5rem; line-height: 1.6;">
                Group 21 Final Project<br>
            </p>
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <button id="btn-guest-login" class="btn-large btn-primary">
                    <i data-lucide="user"></i> 訪客登入
                </button>
                <button id="btn-google-login" class="btn-large btn-google">
                    <i data-lucide="chrome"></i> Google 登入
                </button>
            </div>
        </div>
    </div>

    <!-- APP VIEW -->
    <div id="app-view" class="hidden">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="brand">
                <div style="background: var(--primary); padding: 6px; border-radius: 8px; display:flex;">
                    <i data-lucide="bot" color="white"></i>
                </div>
                AWS Assistant
            </div>
            <nav class="nav-menu" id="nav-buttons-desktop">
                <!-- JS Generated -->
            </nav>
            <div class="user-panel">
                <div class="user-info">
                    <div class="avatar">
                        <img id="user-avatar" class="hidden" alt="">
                        <i id="user-icon" data-lucide="user" color="#94a3b8"></i>
                    </div>
                    <div style="overflow: hidden;">
                        <div id="user-email"
                            style="font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            Guest</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">使用者</div>
                    </div>
                </div>
                <button id="btn-logout"
                    style="width: 100%; padding: 0.5rem; background: transparent; border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <i data-lucide="log-out" width="16"></i> 登出系統
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Mobile Header -->
            <header class="mobile-header">
                <div style="display: flex; align-items: center; gap: 0.5rem; font-weight: bold; color: #818cf8;">
                    <i data-lucide="bot"></i> AWS Assistant
                </div>
                <button id="btn-logout-mobile" style="background: none; border: none; color: var(--text-muted);">
                    <i data-lucide="log-out"></i>
                </button>
            </header>

            <div class="scroll-container custom-scrollbar">

                <!-- 1. DASHBOARD -->
                <section id="dashboard-section" class="max-w-container animate-fade-in hidden">
                    <header style="margin-bottom: 2rem;">
                        <h2 style="font-size: 2rem; margin-bottom: 0.5rem;">你好，歡迎回來</h2>
                        <p style="color: var(--text-muted);">語音控制系統已準備</p>
                    </header>

                    <div class="card hero-card">
                        <button id="btn-voice-main" class="mic-btn-large">
                            <i data-lucide="mic" width="40" height="40"></i>
                        </button>
                        <p id="voice-status-text" style="margin-top: 1.5rem; color: #c7d2fe; font-size: 1.2rem;">
                            點擊麥克風，開始語音指令</p>
                        <div
                            style="margin-top: 1rem; display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
                            <span
                                style="background: rgba(0,0,0,0.3); padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; color: #94a3b8;">"台北天氣"</span>
                            <span
                                style="background: rgba(0,0,0,0.3); padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; color: #94a3b8;">"記帳午餐100元"</span>
                            <span
                                style="background: rgba(0,0,0,0.3); padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; color: #94a3b8;">"搜尋
                                AWS 服務"</span>
                        </div>
                    </div>

                    <div class="grid-3">
                        <div class="card feature-card" onclick="window.app.router.navigate('weather')">
                            <div class="icon-box" style="background: rgba(250, 204, 21, 0.1);">
                                <i data-lucide="sun" color="#facc15"></i>
                            </div>
                            <h3>天氣預報</h3>
                        </div>
                        <div class="card feature-card" onclick="window.app.router.navigate('expense')">
                            <div class="icon-box" style="background: rgba(16, 185, 129, 0.1);">
                                <i data-lucide="wallet" color="#10b981"></i>
                            </div>
                            <h3>記帳管理</h3>
                        </div>
                        <div class="card feature-card" onclick="window.app.router.navigate('search')">
                            <div class="icon-box" style="background: rgba(168, 85, 247, 0.1);">
                                <i data-lucide="search" color="#a855f7"></i>
                            </div>
                            <h3>AI 智慧搜尋</h3>
                        </div>
                    </div>
                </section>

                <!-- 2. WEATHER -->
                <section id="weather-section" class="max-w-container hidden" style="height: 100%;">
                    <div class="top-bar">
                        <button class="back-btn" onclick="window.app.router.navigate('dashboard')">
                            <i data-lucide="arrow-left" width="18"></i> 返回菜單
                        </button>
                        <form id="weather-search-form" class="input-group">
                            <i data-lucide="map-pin" class="input-icon-left" width="18"></i>
                            <input id="weather-search-input" type="text" class="input-field"
                                placeholder="輸入城市 (如: Tokyo)...">
                            <button type="submit" class="input-btn-right">
                                <i data-lucide="search" width="18"></i>
                            </button>
                        </form>
                    </div>

                    <div id="weather-loading" class="hidden text-center"
                        style="padding: 2rem; color: var(--accent-yellow);">
                        正在更新氣象數據...
                    </div>
                    <div id="weather-error" class="hidden text-center"
                        style="padding: 1rem; color: var(--accent-red); background: rgba(239,68,68,0.1); border-radius: var(--radius);">
                    </div>

                    <!-- Debug Button -->
                    <div style="text-align: center; margin-bottom: 1rem;">
                        <button onclick="window.WeatherManager.refresh()"
                            style="background: var(--bg-card); border: 1px solid var(--border); color: var(--text-muted); padding: 4px 12px; border-radius: 4px; cursor: pointer;">
                            <i data-lucide="refresh-cw" width="14"></i> 重新整理
                        </button>
                    </div>

                    <div id="weather-content" class="weather-grid">
                        <!-- Dynamic Content -->
                    </div>
                </section>

                <!-- 3. EXPENSE -->
                <section id="expense-section" class="max-w-container animate-fade-in hidden">
                    <div class="top-bar">
                        <button class="back-btn" onclick="window.app.router.navigate('dashboard')">
                            <i data-lucide="arrow-left" width="18"></i> 返回菜單
                        </button>
                        <div id="expense-mock-badge" class="hidden"
                            style="background: #334155; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; color: #cbd5e1;">
                            試用模式</div>
                    </div>

                    <div class="expense-layout">
                        <div style="display: flex; flex-wrap: wrap; gap: 1.5rem;">
                            <!-- Summary -->
                            <div class="card expense-summary" style="flex: 1; min-width: 280px;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <i data-lucide="wallet" color="#a7f3d0"></i> <span>本月總支出</span>
                                </div>
                                <h2 id="expense-total" style="font-size: 3rem;">$0</h2>
                            </div>

                            <!-- Form -->
                            <form id="expense-form" class="card" style="flex: 2; min-width: 300px;">
                                <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <i data-lucide="plus-circle"></i> 新增支出
                                </h3>
                                <div class="form-row">
                                    <select id="expense-category" class="select-field" style="width: 100px;">
                                        <option value="餐飲">餐飲</option>
                                        <option value="交通">交通</option>
                                        <option value="購物">購物</option>
                                        <option value="娛樂">娛樂</option>
                                        <option value="其他">其他</option>
                                    </select>
                                    <input id="expense-amount" type="number" placeholder="金額" class="input-field"
                                        style="padding-left: 1rem;">
                                </div>
                                <div class="form-row">
                                    <input id="expense-desc" type="text" placeholder="備註 (選填)" class="input-field"
                                        style="padding-left: 1rem;">
                                    <button type="submit" class="btn-large btn-primary"
                                        style="padding: 0.75rem 1.5rem; font-size: 1rem;">新增</button>
                                </div>
                            </form>
                        </div>

                        <!-- Table -->
                        <div class="card" style="padding: 0; overflow: hidden;">
                            <div
                                style="padding: 1rem; border-bottom: 1px solid var(--border-color); font-weight: bold; color: var(--text-muted);">
                                支出明細</div>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>日期</th>
                                            <th>類別</th>
                                            <th>描述</th>
                                            <th style="text-align: right;">金額</th>
                                            <th style="text-align: center;">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="expense-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 4. SEARCH -->
                <section id="search-section" class="max-w-container animate-fade-in hidden"
                    style="height: 100%; display: flex; flex-direction: column;">
                    <div class="top-bar">
                        <button class="back-btn" onclick="window.app.router.navigate('dashboard')">
                            <i data-lucide="arrow-left" width="18"></i> 返回菜單
                        </button>
                    </div>

                    <div class="card"
                        style="background: var(--primary); color: white; display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <div>
                            <h2 style="display: flex; align-items: center; gap: 0.5rem;"><i data-lucide="sparkles"
                                    color="#facc15"></i> AI 智慧助理</h2>
                            <p style="font-size: 0.9rem; opacity: 0.8; margin-top: 0.2rem;">Powered by AWS Bedrock</p>
                        </div>
                        <i data-lucide="bot" width="40" height="40" style="opacity: 0.2;"></i>
                    </div>

                    <div id="chat-container" class="chat-container custom-scrollbar">
                        <div id="chat-placeholder"
                            style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-muted); opacity: 0.5;">
                            <i data-lucide="bot" width="64" height="64" style="margin-bottom: 1rem;"></i>
                            <p>有什麼我可以幫您的嗎？</p>
                        </div>
                    </div>

                    <form id="chat-form" class="chat-input-area">
                        <input id="chat-input" type="text" class="input-field" placeholder="輸入訊息..."
                            style="padding-right: 6rem;">
                        <button id="btn-chat-voice" type="button" class="voice-btn-chat">
                            <i data-lucide="mic"></i>
                        </button>
                        <button type="submit" class="send-btn-chat">
                            <i data-lucide="send" width="18"></i>
                        </button>
                    </form>
                </section>

            </div>

            <!-- Mobile Bottom Nav -->
            <nav class="mobile-nav">
                <button class="nav-btn"
                    style="flex-direction: column; gap: 2px; font-size: 0.7rem; justify-content: center; align-items: center;"
                    onclick="window.app.router.navigate('dashboard')">
                    <i data-lucide="layout-dashboard" width="20"></i> 首頁
                </button>
                <button class="nav-btn"
                    style="flex-direction: column; gap: 2px; font-size: 0.7rem; justify-content: center; align-items: center;"
                    onclick="window.app.router.navigate('weather')">
                    <i data-lucide="sun" width="20"></i> 天氣
                </button>
                <button class="nav-btn"
                    style="flex-direction: column; gap: 2px; font-size: 0.7rem; justify-content: center; align-items: center;"
                    onclick="window.app.router.navigate('expense')">
                    <i data-lucide="wallet" width="20"></i> 記帳
                </button>
                <button class="nav-btn"
                    style="flex-direction: column; gap: 2px; font-size: 0.7rem; justify-content: center; align-items: center;"
                    onclick="window.app.router.navigate('search')">
                    <i data-lucide="search" width="20"></i> 搜尋
                </button>
            </nav>
        </main>
    </div>

    <script>
        // Inject Firebase Configuration for firebase-init.js
        window.__firebase_config = JSON.stringify({
            /*
            apiKey: "AIzaSyCyFu4JCvqGtj6H1pInPE5wfpOTaNnubBE",
            authDomain: "personal-assistant-rob.firebaseapp.com",
            projectId: "personal-assistant-rob",
            storageBucket: "personal-assistant-rob.firebasestorage.app",
            messagingSenderId: "10282114344",
            appId: "1:10282114344:web:f6d0994368ddbab14d041d",
            measurementId: "G-5SZXXN8M09"
            */
            apiKey: "AIzaSyC6tPAAZ5d9IfQFGXfl9NoDO-ywBBq6jFY",
            authDomain: "personal-assistant-robot-9cd97.firebaseapp.com",
            projectId: "personal-assistant-robot-9cd97",
            storageBucket: "personal-assistant-robot-9cd97.firebasestorage.app",
            messagingSenderId: "696492706196",
            appId: "1:696492706196:web:8527a7f3ea32b7153ba781",
            measurementId: "G-14RMJ0TE0X"

        });
    </script>

    <!-- AWS SDK -->
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1547.0.min.js"></script>
    
    <!-- LOGIC -->
    <script src="scripts/config.js"></script>
    <script src="scripts/utils.js"></script>
    <script src="scripts/aws-transcribe.js"></script>
    <script src="scripts/voice.js"></script>
    <script src="scripts/weather.js"></script>
    <script src="scripts/expense.js"></script>
    <script src="scripts/search.js"></script>
    <script src="scripts/router.js"></script>
    <script src="scripts/auth.js"></script>
    <script src="scripts/app.js"></script>

    <!-- FIREBASE MODULE (Optimistic Loading) -->
    <script type="module" src="scripts/firebase-init.js"></script>
</body>

</html>